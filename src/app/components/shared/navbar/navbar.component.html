<header class="nav" [class.open]="open()" [class.compact]="compact()" [class.hidden]="hidden()">
  <div class="container">
    <a class="brand" routerLink="/" (click)="close()" aria-label="Clayshan home">
      <span class="brand-text">Clayshan</span>
      <img [src]="logo" alt="" class="logo wordmark" aria-hidden="true" />
      <span class="sr-only">Clayshan</span>
    </a>
    
    <nav class="links" aria-label="Primary">
      <div class="dropdown" (mouseenter)="showCats.set(true)" (mouseleave)="showCats.set(false)">
        <a routerLink="/collections" routerLinkActive="active" (click)="close()">Collections</a>
        <div class="panel" *ngIf="showCats() && categories().length">
          <a *ngFor="let c of categories()" [routerLink]="['/collections']" [queryParams]="{ category: c.name }" (click)="showCats.set(false)">{{ c.name }} ({{ c.count }})</a>
        </div>
      </div>
      <a routerLink="/about" routerLinkActive="active" (click)="close()">About</a>
      <a routerLink="/contact" routerLinkActive="active" (click)="close()">Contact</a>
      <a routerLink="/wishlist" routerLinkActive="active" (click)="close()">Wishlist <span class="count" *ngIf="wishlistCount() > 0">{{ wishlistCount() }}</span></a>
      <a routerLink="/track" routerLinkActive="active" (click)="close()">Track Order</a>
      <div class="cart-wrap" (click)="$event.stopPropagation()">
        <a href="#" class="cart-link" (click)="toggleCart($event)">Cart <span class="count" *ngIf="count() > 0">{{ count() }}</span></a>
        <div class="mini-cart" *ngIf="cartOpen()">
          <div *ngIf="items().length === 0" class="empty">Your cart is empty.</div>
          <div class="line" *ngFor="let it of items()">
            <img [src]="it.image || 'assets/placeholder.svg'" alt="" (error)="imgError($event)" />
            <div class="meta">
              <div class="name">{{ it.name }}</div>
              <div class="qty">
                <button (click)="cart.dec(it.id)" aria-label="Decrease">-</button>
                <span>{{ it.qty }}</span>
                <button (click)="cart.inc(it.id)" aria-label="Increase">+</button>
              </div>
            </div>
            <div class="price">{{ it.price * it.qty | currency: it.currency }}</div>
            <button class="remove" (click)="remove(it.id)" aria-label="Remove">×</button>
          </div>
          <div class="total" *ngIf="items().length">
            <span>Subtotal</span><span>{{ total() | currency: (items()[0]?.currency || 'INR') }}</span>
          </div>
          <div class="actions" *ngIf="items().length">
            <a routerLink="/cart" class="btn primary" (click)="closeCart()">View Cart & Checkout</a>
          </div>
        </div>
      </div>
      <a *ngIf="admin.loggedIn()" routerLink="/admin" routerLinkActive="active" (click)="close()">Admin</a>
      <a *ngIf="admin.loggedIn()" routerLink="/admin/orders" routerLinkActive="active" (click)="close()">Orders</a>
    </nav>
    <button class="menu" aria-label="Menu" [attr.aria-expanded]="open()" (click)="toggle()">
      <span></span><span></span><span></span>
    </button>
  </div>
  <div class="sheet" (click)="close()">
    <div class="sheet-inner" (click)="$event.stopPropagation()">
      <a routerLink="/collections" (click)="close()">Collections</a>
      <a routerLink="/about" (click)="close()">About</a>
      <a routerLink="/contact" (click)="close()">Contact</a>
      <a routerLink="/wishlist" (click)="close()">Wishlist <span class="count" *ngIf="wishlistCount() > 0">{{ wishlistCount() }}</span></a>
      <a routerLink="/track" (click)="close()">Track Order</a>
      <a routerLink="/cart" (click)="close()" class="cart-link">Cart <span class="count" *ngIf="count() > 0">{{ count() }}</span></a>
      <a *ngIf="admin.loggedIn()" routerLink="/admin" (click)="close()">Admin</a>
      <a *ngIf="admin.loggedIn()" routerLink="/admin/orders" (click)="close()">Orders</a>
    </div>
  </div>
  
  <!-- Mobile cart sheet -->
  <div class="cart-sheet" *ngIf="cartOpen()" (click)="closeCart()">
    <div class="inner" (click)="$event.stopPropagation()">
      <header>
        <div class="title">Your Cart</div>
        <button class="close" (click)="closeCart()" aria-label="Close">×</button>
      </header>
      <div class="lines" *ngIf="items().length; else emptyCart">
        <div class="line" *ngFor="let it of items()">
          <img [src]="it.image || 'assets/placeholder.svg'" alt="" (error)="imgError($event)" />
          <div class="meta">
            <div class="name">{{ it.name }}</div>
            <div class="qty">
              <button (click)="cart.dec(it.id)" aria-label="Decrease">-</button>
              <span>{{ it.qty }}</span>
              <button (click)="cart.inc(it.id)" aria-label="Increase">+</button>
            </div>
          </div>
          <div class="price">{{ it.price * it.qty | currency: it.currency }}</div>
          <button class="remove" (click)="remove(it.id)" aria-label="Remove">×</button>
        </div>
        <div class="total">
          <span>Subtotal</span><span>{{ total() | currency: (items()[0]?.currency || 'INR') }}</span>
        </div>
        <a routerLink="/cart" class="btn primary" (click)="closeCart()">View Cart & Checkout</a>
      </div>
      <ng-template #emptyCart>
        <div class="empty">Your cart is empty.</div>
      </ng-template>
    </div>
  </div>
</header>
<!-- Floating WhatsApp button removed per request -->

<!-- Mobile bottom tab bar -->
<nav class="bottom-nav" aria-label="Primary mobile">
  <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact:true}">
    <span class="ico"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 11l9-8 9 8"/><path d="M9 22V12h6v10"/></svg></span>
    <span class="lab">Home</span>
  </a>
  <a routerLink="/collections" routerLinkActive="active">
    <span class="ico"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2l3 7h6l3-7"/><path d="M6 9v11a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V9z"/></svg></span>
    <span class="lab">Shop</span>
  </a>
  <a routerLink="/wishlist" routerLinkActive="active">
    <span class="ico"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.8 4.6a5.5 5.5 0 0 0-7.8 0L12 5.6l-1-1a5.5 5.5 0 0 0-7.8 7.8l1 1L12 22l7.8-8.6 1-1a5.5 5.5 0 0 0 0-7.8z"/></svg></span>
    <span class="lab">Wishlist</span>
  </a>
  <a routerLink="/cart" routerLinkActive="active" class="cart-tab">
    <span class="ico"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 12.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg></span>
    <span class="lab">Cart</span>
    <span class="badge" *ngIf="count() > 0">{{ count() }}</span>
  </a>
  <a [href]="whUrl()" target="_blank" rel="noopener" class="wh-tab">
    <span class="ico"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/></svg></span>
    <span class="lab">Chat</span>
  </a>
</nav>
